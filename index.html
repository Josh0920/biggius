<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Koine Greek • Study</title>
  <style>
    :root {
      --bg:#ffffff;
      --panel:#ffffff;
      --card:#ffffff;
      --line:#e7e7e7;
      --text:#111111;
      --muted:#5a5a5a;

      --ok:#1a7f37;
      --bad:#b42318;

      --shadow: 0 14px 45px rgba(0,0,0,.08);
      --radius: 16px;
      --radius2: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height:100vh;
    }

    .app{
      max-width: 1240px;
      margin: 0 auto;
      padding: 18px;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }

    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
      .sidebar{ order:2; }
      .main{ order:1; }
    }

    .panel{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Sidebar */
    .sidebarHeader{
      padding: 16px 16px 12px;
      border-bottom:1px solid var(--line);
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width: 42px; height: 42px;
      border-radius: 12px;
      border: 1px solid var(--line);
      display:grid;
      place-items:center;
      font-weight: 900;
      letter-spacing:.2px;
      font-size: 16px;
    }
    .brand h1{ margin:0; font-size: 14px; line-height:1.2; }
    .brand p{ margin:4px 0 0; color: var(--muted); font-size: 12px; }
    .searchWrap{ padding: 12px 16px; border-bottom:1px solid var(--line); }
    .search {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      outline:none;
      font-size: 13px;
      background: #fff;
      color: var(--text);
    }
    .search:focus{ border-color:#111; }

    .sideList{ padding: 10px 8px 14px; }
    .groupTitle{
      padding: 10px 10px 8px;
      color: var(--muted);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }
    .itemBtn{
      width:100%;
      text-align:left;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: transparent;
      cursor:pointer;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      font-size: 13px;
      color: var(--text);
      transition: .12s ease;
    }
    .itemBtn:hover{ background:#f7f7f7; }
    .itemBtn.active{ background:#111; color:#fff; }
    .tag{
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--line);
      color: var(--muted);
      background: #fff;
      flex: 0 0 auto;
    }
    .itemBtn.active .tag{ background:#111; border-color:#444; color:#fff; }

    /* Main */
    .topbar{
      padding: 14px 16px 12px;
      border-bottom: 1px solid var(--line);
    }
    .topRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:flex-start; justify-content:space-between; }
    .titleBlock h2{ margin:0; font-size: 16px; }
    .titleBlock p{ margin:6px 0 0; color: var(--muted); font-size: 12px; }
    .stats{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .pill{
      font-size: 12px;
      padding: 6px 10px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: #fff;
      color: var(--muted);
    }
    .pill strong{ color: var(--text); font-weight: 700; }

    .progressBar{
      margin-top: 12px;
      height: 10px;
      border-radius: 999px;
      background: #f1f1f1;
      border: 1px solid var(--line);
      overflow:hidden;
    }
    .progressFill{
      height:100%;
      width:0%;
      background:#111;
      border-radius: 999px;
      transition: width .2s ease;
    }

    .content{ padding: 16px; }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 16px;
    }

    .bigGreek{
      font-size: 36px;
      letter-spacing: .3px;
      margin: 2px 0 0;
    }
    .muted{ color: var(--muted); font-size: 13px; margin-top: 8px; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }

    .btn{
      border: 1px solid var(--line);
      background:#fff;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-size: 13px;
      transition: .12s ease;
    }
    .btn:hover{ background:#f7f7f7; }
    .btn.primary{ background:#111; color:#fff; border-color:#111; }
    .btn.primary:hover{ background:#000; }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    .input{
      width: min(520px, 100%);
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      outline:none;
      font-size: 14px;
      background:#fff;
      color: var(--text);
    }
    .input:focus{ border-color:#111; }
    .input.ok{ border-color: rgba(26,127,55,.6); box-shadow: 0 0 0 3px rgba(26,127,55,.10); }
    .input.bad{ border-color: rgba(180,35,24,.6); box-shadow: 0 0 0 3px rgba(180,35,24,.10); }

    .feedback{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background:#fafafa;
      font-size: 13px;
      color: var(--text);
    }
    .feedback.ok{ border-color: rgba(26,127,55,.4); background: rgba(26,127,55,.06); }
    .feedback.bad{ border-color: rgba(180,35,24,.4); background: rgba(180,35,24,.06); }

    /* Chart UI */
    .chartWrap{ display:grid; gap: 14px; grid-template-columns: 1.2fr .8fr; }
    @media (max-width: 980px){ .chartWrap{ grid-template-columns: 1fr; } }

    .chartTable{
      width:100%;
      border-collapse: collapse;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid var(--line);
    }
    .chartTable th, .chartTable td{
      padding: 10px 10px;
      border-bottom: 1px solid var(--line);
      border-right: 1px solid var(--line);
      font-size: 13px;
      vertical-align: middle;
    }
    .chartTable th{ background:#fafafa; font-weight: 700; font-size: 12px; color: var(--muted); }
    .chartTable tr:last-child td{ border-bottom:none; }
    .chartTable td:last-child, .chartTable th:last-child{ border-right:none; }

    /* Pronoun grid header centering fix */
    .centerTh{ text-align:center; }
    .centerTd{ text-align:center; }

    .slot{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width: 110px;
      padding: 9px 10px;
      border-radius: 12px;
      background:#fff;
      border: 1px dashed #bdbdbd;
      color: var(--muted);
      cursor:pointer;
      user-select:none;
      transition: .12s ease;
    }
    .slot.filled{ border-style: solid; color: var(--text); }
    .slot.active{ outline: 2px solid #111; outline-offset: 2px; }
    .slot.correct{ border-color: rgba(26,127,55,.55); background: rgba(26,127,55,.06); }
    .slot.wrong{ border-color: rgba(180,35,24,.55); background: rgba(180,35,24,.06); }

    .bank{
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      margin-top: 10px;
    }
    .pillOpt{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background:#fff;
      cursor:pointer;
      font-size: 13px;
      transition:.12s ease;
    }
    .pillOpt:hover{ background:#f7f7f7; }
    .pillOpt.used{ opacity:.4; cursor:not-allowed; }
    .kbd{ font-family: var(--mono); font-size: 11px; border: 1px solid var(--line); padding: 2px 7px; border-radius: 9px; background:#fff; color: var(--muted); }

    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      border: 1px solid var(--line);
      background:#fff;
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      max-width: 360px;
      opacity: 0;
      transform: translateY(10px);
      pointer-events:none;
      transition: .16s ease;
    }
    .toast.show{ opacity: 1; transform: translateY(0); }
    .toast strong{ display:block; margin-bottom: 3px; }
    .toast .tmuted{ color: var(--muted); font-size: 12px; }

    .miniSelect{
      border: 1px solid var(--line);
      background:#fff;
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      outline:none;
      max-width: 100%;
    }
  </style>
</head>

<body>
  <div class="app">
    <aside class="panel sidebar">
      <div class="sidebarHeader">
        <div class="brand">
          <div class="logo">Κ</div>
          <div>
            <h1>Koine Greek Study</h1>
            <p id="sideMeta">—</p>
          </div>
        </div>
      </div>

      <div class="searchWrap">
        <input id="activitySearch" class="search" type="text" placeholder="Search (e.g., Demonstrative Pronouns)" />
      </div>

      <div id="sideList" class="sideList"></div>
    </aside>

    <main class="panel main">
      <div class="topbar">
        <div class="topRow">
          <div class="titleBlock">
            <h2 id="mainTitle">—</h2>
            <p id="mainSub">—</p>
          </div>
          <div class="stats">
            <span class="pill"><strong id="statProgress">0/0</strong> <span id="statProgressLabel">items</span></span>
            <span class="pill"><strong id="statScore">0</strong> score</span>
            <span class="pill"><strong id="statStreak">0</strong> streak</span>
          </div>
        </div>
        <div class="progressBar"><div id="progressFill" class="progressFill"></div></div>
      </div>

      <div class="content" id="content"></div>
    </main>
  </div>

  <div class="toast" id="toast">
    <strong id="toastTitle">—</strong>
    <div class="tmuted" id="toastMsg">—</div>
  </div>

<script>
/* =========================
   DATA (UPDATED VOCAB)
   ========================= */

const DATA = {
  VOCAB: /* UPDATED FROM YOUR DOCX (deduped) */ [
    /* (Auto-generated) */
    {"g":"ἅγγελος","e":"angel, messenger"},
    {"g":"ἀμην","e":"amen"},
    {"g":"ἄνθρωπος","e":"man, mankind"},
    {"g":"ἀπόστολος","e":"apostle"},
    {"g":"Γαλιλαία","e":"galilee"},
    {"g":"γραφή","e":"writing"},
    {"g":"δόξα","e":"glory, majesty, fame"},
    {"g":"ἐγώ","e":"I"},
    {"g":"ἔσχατος","e":"last"},
    {"g":"ζωή","e":"life"},
    {"g":"θεός","e":"God"},
    {"g":"καί","e":"and, even, also, namely"},
    {"g":"καρδία","e":"heart, inner self"},
    {"g":"κόσμος","e":"world, universe, mankind"},
    {"g":"λόγος","e":"word, Word, statement, message"},
    {"g":"πνεύμα","e":"spirit, Spirit, wind, breath, inner self"},
    {"g":"προφήτης","e":"prophet"},
    {"g":"σάββατον","e":"sabbath"},
    {"g":"φωνή","e":"sound, noise, voice"},
    {"g":"χριστός","e":"Christ, Messiah, Anointed One"},
    {"g":"ἀγαπή","e":"love"},
    {"g":"ἂλλος","e":"other, another"},
    {"g":"αὐτός","e":"singular: he, she, it (him, her); plural: they (them)"},
    {"g":"βασιλεία","e":"kingdom"},
    {"g":"δέ","e":"but, and"},
    {"g":"ἐν","e":"in, on, among"},
    {"g":"ἒργον","e":"work, deed, action"},
    {"g":"καιρός","e":"(appointed) time, season"},
    {"g":"νῦν","e":"adverb: now; noun: the present"},
    {"g":"ό, ή, τό","e":"the"},
    {"g":"ὃτι","e":"that, since, because"},
    {"g":"οὐ","e":"not"},
    {"g":"ὣρα","e":"hour, occasion, moment"},
    {"g":"ἁμαρτία","e":"sin"},
    {"g":"ἀρχή","e":"beginning; ruler"},
    {"g":"γάρ","e":"for; then"},
    {"g":"εἷπεν","e":"he/she/it said"},
    {"g":"εἰς","e":"into; in"},
    {"g":"ἐξουσία","e":"authority, power"},
    {"g":"εὐαγγέλιον","e":"good news, Gospel"},
    {"g":"Ἰησοῦς","e":"Jesus, Joshua"},
    {"g":"κύριος","e":"Lord; lord, master, sir"},
    {"g":"μή","e":"not, lest"},
    {"g":"οὐρανός","e":"heaven; sky"},
    {"g":"οὖτος, αὓτη, τοῦτο","e":"singular: this (one); plural: these"},
    {"g":"σύ","e":"you (singular)"},
    {"g":"υἱός","e":"son; descendant"},
    {"g":"ὣστε","e":"therefore, so that"},
    {"g":"ἀλλά","e":"ἀλλ᾽) (but, yet; rather"},
    {"g":"ἀπό","e":"ἀπ᾽, ἀφ᾽) (gen: (away) from"},
    {"g":"διά","e":"δι᾽) (gen: through; acc: on account of"},
    {"g":"εἰμί","e":"I am, exist, live, am present"},
    {"g":"ἐκ","e":"ἐξ) (gen: from, out of"},
    {"g":"ἡμέρα","e":"day"},
    {"g":"ἦν","e":"he/she/it was"},
    {"g":"θάλασσα","e":"sea, lake"},
    {"g":"θάνατος","e":"death"},
    {"g":"ἳνα","e":"in order that; that; so that"},
    {"g":"Ἰωάννης","e":"John"},
    {"g":"λέγω","e":"I say, speak"},
    {"g":"μετά","e":"μετ᾽, μεθ᾽) (gen: with; acc: after"},
    {"g":"οἰκία","e":"house, home"},
    {"g":"οἶκος","e":"house, home"},
    {"g":"ὂχλος","e":"crowd, multitude"},
    {"g":"παρά","e":"παρ᾽) (gen: from; dat: beside, in the presence of; acc: alongside of"},
    {"g":"παραβολή","e":"parable"},
    {"g":"πρός","e":"acc: to, towards; with"},
    {"g":"ὑπό","e":"ὑπ᾽, ὑφ᾽) (gen: by; acc: under"},
    {"g":"ἀγαθός","e":"good, useful"},
    {"g":"ἀγαπητός","e":"beloved"},
    {"g":"ἃγιος","e":"adjective: holy; plural noun: saints"},
    {"g":"αἰώνιος","e":"eternal"},
    {"g":"ἀλλήλων","e":"one another"},
    {"g":"ἀπεκρίθη","e":"he/she/it answered"},
    {"g":"δοῦλος","e":"slave; servant"},
    {"g":"ἐάν","e":"if; when"},
    {"g":"ἐμός, ἐμή, ἐμόν","e":"my, mine"},
    {"g":"ἐντολή","e":"commandment"},
    {"g":"καθώς","e":"as, even as"},
    {"g":"κακός","e":"bad, evil"},
    {"g":"μου","e":"ἐμοῦ) (my"},
    {"g":"νεκρός","e":"adjective: dead; noun: dead body, corpse"},
    {"g":"πιστός","e":"faithful, believing"},
    {"g":"πονηρός","e":"evil, bad"},
    {"g":"πρῶτος","e":"first; earlier"},
    {"g":"τρίτος","e":"third"},
    {"g":"εἰ","e":"if"},
    {"g":"εἰ μή","e":"except; if not"},
    {"g":"εἷς, μία, ἓν","e":"one"},
    {"g":"ἢδη","e":"now, already"},
    {"g":"ὂνομα, –ατος, τό","e":"name; reputation"},
    {"g":"οὐδείς, οὐδεμία, οὐδέν","e":"no one, none, nothing"},
    {"g":"πᾶς, πᾶσα, πᾶν","e":"singular: each, every; plural: all"},
    {"g":"περί","e":"genitive: concerning, about; accusative: around"},
    {"g":"σάρξ, σαρκός, ἡ","e":"flesh; body"},
    {"g":"σύν","e":"dative: with"},
    {"g":"σῶμα, –ατος, τό","e":"body"},
    {"g":"τέκνον, –ου, τό","e":"child; descendant"},
    {"g":"τίς, τί","e":"Who? What? Which? Why?"},
    {"g":"τις, τι","e":"Someone/thing; certain one/thing; anyone/thing"},
    {"g":"πνεῦμα, —ατος, τό","e":"spirit, Spirit"},
    {"g":"Σίμων, —ωνος, ὁ","e":"Simon"},
    {"g":"ἀδελφός, οῦ, ὁ","e":"brother"},
    {"g":"ἂν","e":"“-ever”"},
    {"g":"ἀνήρ, ἀνδρός, ὁ","e":"male; husband; man"},
    {"g":"έκκλησία, ας, ἡ","e":"a church; (the) Church; assembly, congregation"},
    {"g":"ἐλπίς, ίδος, ἡ","e":"hope, expectation"},
    {"g":"ἒξω","e":"adverb: without; preposition (gen): outside"},
    {"g":"ἐπί","e":"ἐπ᾽,ἐφ᾽) (gen: on, over, when; dat: on the basis of, at; acc: on, to, against"},
    {"g":"ἡμεῖς","e":"we"},
    {"g":"θέλημα, θελήματος, τό","e":"will, desire"},
    {"g":"ἲδε","e":"See! Behold!"},
    {"g":"ἰδού","e":"See! Behold!"},
    {"g":"καλος, ή, όν","e":"good; beautiful"},
    {"g":"μήτηρ, μητρος, ἡ","e":"mother"},
    {"g":"οὐδέ","e":"and, not, not even; neither, nor"},
    {"g":"πατήρ, πατρός, ὁ","e":"father"},
    {"g":"πίστις, πίστεως, ἡ","e":"faith, belief; trust, “teaching” in that what is believed"},
    {"g":"ὓδωρ, ὓδατος, τό","e":"water"},
    {"g":"ὑμεῖς","e":"you (plural)"},
    {"g":"φῶς, φωτός, τό","e":"light"},
    {"g":"χάρις, χάριτος, ἡ","e":"grace, favor, kindness"},
    {"g":"ὧδε","e":"here"},
    {"g":"αἰών, ῶνος, ὁ","e":"age, eternity"},
    {"g":"διδάσκαλος, ου, ὁ","e":"teacher"},
    {"g":"εὐθύς","e":"immediately"},
    {"g":"ἓως","e":"conj: until; preposition (gen): as far as"},
    {"g":"μαθητής, οῦ, ὁ","e":"disciple"},
    {"g":"μέν","e":"on the one hand; indeed"},
    {"g":"μηδείς, μηδεμία, μηδέν","e":"no one/thing"},
    {"g":"μόνος, η, ον","e":"alone, only"},
    {"g":"ὃπως","e":"how; (in order) that"},
    {"g":"ὃσος, η, ον","e":"as great as, as many as"},
    {"g":"οὖν","e":"therefore, accordingly; then"},
    {"g":"ὀφθαλμός, οῦ, ὁ","e":"eye, sight"},
    {"g":"πάλιν","e":"again"},
    {"g":"πούς, ποδός, ὁ","e":"foot"},
    {"g":"ὑπέρ","e":"gen: in behalf of; acc: above"},
    {"g":"γυνή, γυναικός, ἡ","e":"woman; wife"},
    {"g":"δικαιοσύνη","e":"righteousness"},
    {"g":"δώδεκα","e":"twelve"},
    {"g":"ἑαυτοῦ, ῆς, οῦ","e":"sing: himself/herself/itself; pl: themselves"},
    {"g":"ἐκεῖνος, η, ο","e":"sing: that man/woman/thing; pl: those men/women/things"},
    {"g":"ἤ","e":"or; than"},
    {"g":"κἀγώ","e":"and I; but I"},
    {"g":"μακάριος, ία, ιον","e":"blessed, happy"},
    {"g":"μέγας, μεγάλη, μέγα","e":"large; great"},
    {"g":"πόλις, εως, ἡ","e":"city, town"},
    {"g":"πολύς, πολλή, πολύ","e":"sing: much; pl: many; adverb: often"},
    {"g":"πῶς","e":"how?"},
    {"g":"σημεῖον","e":"sign, miracle"},
    {"g":"ἀλήθεια","e":"truth"},
    {"g":"εἰρήνη","e":"peace"},
    {"g":"ἐνώπιον","e":"gen: before"},
    {"g":"ἐπαγγελία","e":"promise"},
    {"g":"ἑπτά","e":"seven"},
    {"g":"θρόνος","e":"throne"},
    {"g":"Ἰερουσαλήμ, ἡ","e":"Jerusalem"},
    {"g":"κατά","e":"κατ᾽, καθ᾽) (gen: down from, against; acc: according to, throughout, during"},
    {"g":"κεφαλή","e":"head"},
    {"g":"ὁδός","e":"way, road; journey, conduct"},
    {"g":"ὃς, ἣ, ὃ","e":"who (whom), which"},
    {"g":"ὃτε","e":"when"},
    {"g":"οὓτως","e":"thus, so; in this manner"},
    {"g":"πλοῖον","e":"ship, boat"},
    {"g":"ῥῆμα, ατος, τό","e":"word, saying"},
    {"g":"τέ","e":"and (so), so"},
    {"g":"χείρ, χειρός, ἡ","e":"hand"},
    {"g":"ψυχή","e":"life; soul; self"},
    {"g":"ἀκούω","e":"I hear; learn, obey; understand"},
    {"g":"βλέπω","e":"I see, look at"},
    {"g":"ἒχω","e":"I have, hold"},
    {"g":"λύω","e":"I loose, untie, destroy"},
    {"g":"νόμος, ου, ὁ","e":"law; principle"},
    {"g":"ὃπου","e":"where"},
    {"g":"πιστεύω","e":"I believe, have faith (in), trust"},
    {"g":"πρόσωπον, ου, τό","e":"face; appearance"},
    {"g":"τότε","e":"then; thereafter"},
    {"g":"τυφλός, ή, όν","e":"blind"},
    {"g":"χαρά, ᾶς, ἡ","e":"joy, delight"},
    {"g":"ἀγαπάω","e":"I love, cherish"},
    {"g":"δαιμόνιον, ου, τό","e":"demon"},
    {"g":"ζητέω","e":"I seek, desire, try to obtain"},
    {"g":"καλέω","e":"I call, name, invite"},
    {"g":"λαλέω","e":"I speak, say"},
    {"g":"οἶδα","e":"I know, understand"},
    {"g":"ὃταν","e":"whenever"},
    {"g":"πλείων, πλεῖον","e":"larger, more"},
    {"g":"πληρόω","e":"I fill, complete, fulfill"},
    {"g":"ποιέω","e":"I do, make"},
    {"g":"τηρέω","e":"I keep, guard, observe"},
    {"g":"ἀποκρίνομαι","e":"I answer"},
    {"g":"δεῖ","e":"it is necessary"},
    {"g":"δύναμαι","e":"I am able, am powerful"},
    {"g":"ἒρχομαι","e":"I come, go"},
    {"g":"νύξ, νυκτός, ἡ","e":"night"},
    {"g":"ὃστις, ἣτις, ὃτι","e":"whoever, whichever, whatever"},
    {"g":"πορεύομαι","e":"I go, proceed; live"},
    {"g":"συνάγω","e":"I gather together, bright together; lead"},
    {"g":"τόπος","e":"place; location"},
    {"g":"ὡς","e":"as, like; that; approximately; when, after"},
    {"g":"βασιλεύς, έως, ὁ","e":"king"},
    {"g":"γεννάω","e":"I beget, give birth to; produce"},
    {"g":"ζάω","e":"I live"},
    {"g":"Ἰουδαία","e":"Judea"},
    {"g":"Ἰουδαῖος, αία, αῖον","e":"adjective: Jewish; noun: Jew"},
    {"g":"Ἰσραήλ","e":"Israel"},
    {"g":"καρπός","e":"fruit; crop; result"},
    {"g":"μείζων","e":"greater"},
    {"g":"ὃλος, η, ον","e":"adjective: whole, complete; adverb: entirely"},
    {"g":"προσκυνέω","e":"I worship"},
    {"g":"αἲρω","e":"I raise, take up, take away"},
    {"g":"ἀποκτείνω","e":"I kill"},
    {"g":"ἀποστέλλω","e":"I send (away)"},
    {"g":"βαπτίζω","e":"I baptize; dip, immerse"},
    {"g":"γινώσκω","e":"I know, come to know, realize, learn"},
    {"g":"γλῶσσα, —ης, ἡ","e":"tongue, language"},
    {"g":"ἐγείρω","e":"I raise up, wake"},
    {"g":"ἐκβάλλω","e":"I cast out, send out"},
    {"g":"ἐκεῖ","e":"there, in that place"},
    {"g":"κρίνω","e":"I judge, decide, prefer"},
    {"g":"λαός, —οῦ, ὁ","e":"people, crowd"},
    {"g":"μένω","e":"I remain, live"},
    {"g":"ὁράω","e":"I see, notice, experience"},
    {"g":"σοφία, —ας, ἡ","e":"wisdom"},
    {"g":"στόμα, —ατος, τό","e":"mouth"},
    {"g":"σῴζω","e":"I save, deliver, rescue"},
    {"g":"ἀκολουθέω","e":"I follow; accompany"},
    {"g":"διδάσκω","e":"I teach"},
    {"g":"ἐπερωτάω","e":"I ask (for)"},
    {"g":"ἐρωτάω","e":"I ask; request"},
    {"g":"θέλω","e":"I wish, desire; enjoy"},
    {"g":"περιτατέω","e":"I walk (around); live"},
    {"g":"συναγωγή","e":"synagogue; meeting"},
    {"g":"φαρισαῖος","e":"Pharisee"},
    {"g":"χρόνος","e":"time"},
    {"g":"ἀποθνῇσκω","e":"I die, am about to die, am freed from"},
    {"g":"ἂρτος","e":"bread, loaf, food"},
    {"g":"βάλλω","e":"I throw"},
    {"g":"γῆ, γῆς, ἡ","e":"earth, land, region, humanity"},
    {"g":"γίνομαι","e":"I become, take place; am, exist; am born, am created"},
    {"g":"εἰσέρχομαι","e":"I come in(to); go in(to); enter"},
    {"g":"ἐξέρχομαι","e":"I go out"},
    {"g":"ἒτι","e":"still, yet, even"},
    {"g":"εὑρίσκω","e":"I find"},
    {"g":"λαμβάνω","e":"I take; receive"},
    {"g":"οὒτε","e":"And not, neither, nor"},
    {"g":"προσέρχομαι","e":"I come/go to"},
    {"g":"προσεύχομαι","e":"I pray"},
    {"g":"πῦρ, πυρός, τό","e":"fire"},
    {"g":"ἀπέρχομαι","e":"I depart"},
    {"g":"ἂρχομαι","e":"I begin"},
    {"g":"γράφω","e":"I write"},
    {"g":"διό","e":"Therefore, for this reason"},
    {"g":"δοξάζω","e":"I praise, honor, glorify"},
    {"g":"δύναμις","e":"power; miracle"},
    {"g":"κηρύσσω","e":"I proclaim; preach"},
    {"g":"πίνω","e":"I drink"},
    {"g":"ἂγω","e":"I lead, bring, arrest"},
    {"g":"αἷμα","e":"blood"},
    {"g":"ἓκαστος","e":"each, every"},
    {"g":"ἱμάτιον","e":"garment, cloak"},
    {"g":"ὂρος","e":"mountain, hill"},
    {"g":"ὑπάγω","e":"I depart"},
    {"g":"φοβέομαι","e":"I fear"},
    {"g":"χαίρω","e":"I rejoice"},
    {"g":"αἰτέω","e":"I ask; demand"},
    {"g":"μᾶλλον","e":"more, rather"},
    {"g":"μαρτυρέω","e":"I bear witness, testify"},
    {"g":"ἀναβαίνω","e":"I go up"},
    {"g":"ἀρχιερεύς, —έως, ὁ","e":"chief priest, high priest"},
    {"g":"δεξιός, —ά, —όν","e":"right"},
    {"g":"δύο","e":"two"},
    {"g":"ἓτερος, —α, —ον","e":"other; another, different"},
    {"g":"εὐαγγελίζω","e":"I bring good news; preach"},
    {"g":"θεωρέω","e":"I look at; perceive"},
    {"g":"Ἱεροσόλυμα, τά","e":"Jerusalem"},
    {"g":"κάθημαι","e":"I sit (down); live"},
    {"g":"καταβαίνω","e":"I go down; come down"},
    {"g":"οὗ","e":"where"},
    {"g":"παρακαλέω","e":"I call (to one’s side); urge, implore; comfort"},
    {"g":"πείθω","e":"I persuade"},
    {"g":"τρεῖς, τρία","e":"three"}
  ],

  /* verbs auto-detected from your vocab list */
  VERBS: [
    {"g":"εἰμί","e":"I am, exist, live, am present"},
    {"g":"λέγω","e":"I say, speak"},
    {"g":"ἀκούω","e":"I hear; learn, obey; understand"},
    {"g":"βλέπω","e":"I see, look at"},
    {"g":"ἒχω","e":"I have, hold"},
    {"g":"λύω","e":"I loose, untie, destroy"},
    {"g":"πιστεύω","e":"I believe, have faith (in), trust"},
    {"g":"ἀγαπάω","e":"I love, cherish"},
    {"g":"ζητέω","e":"I seek, desire, try to obtain"},
    {"g":"καλέω","e":"I call, name, invite"},
    {"g":"λαλέω","e":"I speak, say"},
    {"g":"οἶδα","e":"I know, understand"},
    {"g":"πληρόω","e":"I fill, complete, fulfill"},
    {"g":"ποιέω","e":"I do, make"},
    {"g":"τηρέω","e":"I keep, guard, observe"},
    {"g":"ἀποκρίνομαι","e":"I answer"},
    {"g":"δεῖ","e":"it is necessary"},
    {"g":"δύναμαι","e":"I am able, am powerful"},
    {"g":"ἒρχομαι","e":"I come, go"},
    {"g":"πορεύομαι","e":"I go, proceed; live"},
    {"g":"συνάγω","e":"I gather together, bright together; lead"},
    {"g":"γεννάω","e":"I beget, give birth to; produce"},
    {"g":"ζάω","e":"I live"},
    {"g":"προσκυνέω","e":"I worship"},
    {"g":"αἲρω","e":"I raise, take up, take away"},
    {"g":"ἀποκτείνω","e":"I kill"},
    {"g":"ἀποστέλλω","e":"I send (away)"},
    {"g":"βαπτίζω","e":"I baptize; dip, immerse"},
    {"g":"γινώσκω","e":"I know, come to know, realize, learn"},
    {"g":"ἐγείρω","e":"I raise up, wake"},
    {"g":"ἐκβάλλω","e":"I cast out, send out"},
    {"g":"κρίνω","e":"I judge, decide, prefer"},
    {"g":"μένω","e":"I remain, live"},
    {"g":"ὁράω","e":"I see, notice, experience"},
    {"g":"σῴζω","e":"I save, deliver, rescue"},
    {"g":"ἀκολουθέω","e":"I follow; accompany"},
    {"g":"διδάσκω","e":"I teach"},
    {"g":"ἐπερωτάω","e":"I ask (for)"},
    {"g":"ἐρωτάω","e":"I ask; request"},
    {"g":"θέλω","e":"I wish, desire; enjoy"},
    {"g":"περιτατέω","e":"I walk (around); live"},
    {"g":"ἀποθνῇσκω","e":"I die, am about to die, am freed from"},
    {"g":"βάλλω","e":"I throw"},
    {"g":"γίνομαι","e":"I become, take place; am, exist; am born, am created"},
    {"g":"εἰσέρχομαι","e":"I come in(to); go in(to); enter"},
    {"g":"ἐξέρχομαι","e":"I go out"},
    {"g":"εὑρίσκω","e":"I find"},
    {"g":"λαμβάνω","e":"I take; receive"},
    {"g":"προσέρχομαι","e":"I come/go to"},
    {"g":"προσεύχομαι","e":"I pray"},
    {"g":"ἀπέρχομαι","e":"I depart"},
    {"g":"ἂρχομαι","e":"I begin"},
    {"g":"γράφω","e":"I write"},
    {"g":"δοξάζω","e":"I praise, honor, glorify"},
    {"g":"κηρύσσω","e":"I proclaim; preach"},
    {"g":"πίνω","e":"I drink"},
    {"g":"ἂγω","e":"I lead, bring, arrest"},
    {"g":"ὑπάγω","e":"I depart"},
    {"g":"φοβέομαι","e":"I fear"},
    {"g":"χαίρω","e":"I rejoice"},
    {"g":"αἰτέω","e":"I ask; demand"},
    {"g":"μαρτυρέω","e":"I bear witness, testify"},
    {"g":"ἀναβαίνω","e":"I go up"},
    {"g":"εὐαγγελίζω","e":"I bring good news; preach"},
    {"g":"θεωρέω","e":"I look at; perceive"},
    {"g":"κάθημαι","e":"I sit (down); live"},
    {"g":"καταβαίνω","e":"I go down; come down"},
    {"g":"παρακαλέω","e":"I call (to one’s side); urge, implore; comfort"},
    {"g":"πείθω","e":"I persuade"}
  ],

  /* your existing chart sets kept */
  VERB_CHARTS: [
    {"id":"verb_01","title":"Present Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ω","εις","ει","ομεν","ετε","ουσι (ν)"]},
    {"id":"verb_02","title":"Present Middle/Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ομαι","ῃ","εται","ομεθα","εσθε","ονται"]},
    {"id":"verb_03","title":"Present εἰμί","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["εἰμι","εἶ","ἐστιν","ἐσμεν","ἐστε","εἰσιν"]},
    {"id":"verb_04","title":"Future Liquid Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ῶ","εῖς","εῖ","οῦμεν","εῖτε","οῦσι(ν)"]},
    {"id":"verb_05","title":"Future Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["σω","σεις","σει","σομεν","σετε","σουσι(ν)"]},
    {"id":"verb_06","title":"Future Middle Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["σομαι","σῃ","σεται","σομεθα","σεσθε","σονται"]},
    {"id":"verb_07","title":"Future Liquid Middle Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["οῦμαι","ῇ","εῖται","οῦμεθα","εῖσθε","οῦνται"]},
    {"id":"verb_08","title":"Future of εἰμί","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ἒσομαι","ἒσῃ","ἒσται","ἐσόμεθα","ἒσεσθε","ἒσονται"]},
    {"id":"verb_09","title":"Future Liquid Middle for κρίνω","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["κρινοῦμαι","κρινῇ","κρινεῖται","κρινοῦμεθα","κρινεῖσθε","κρινοῦνται"]},
    {"id":"verb_10","title":"First Future Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["θήσομαι","θήσῃ","θήσεται","θησόμεθα","θήσεσθε","θήσονται"]},
    {"id":"verb_11","title":"Second Future Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ήσομαι","ήσῃ","ήσεται","ησόμεθα","ήσεσθε","ήσονται"]},
    {"id":"verb_12","title":"Primary Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ω","εις","ει","ομεν","ετε","ουσι"]},
    {"id":"verb_13","title":"Secondary Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]ον","ε[stem]ες","ε[stem]ε(ν)","ε[stem]ομεν","ε[stem]ετε","ε[stem]ον"]},
    {"id":"verb_14","title":"Primary Middle Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ομαι","ῃ","εται","ομεθα","εσθε","ονται"]},
    {"id":"verb_15","title":"Secondary Middle Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]ομην","ε[stem]ου","ε[stem]ετο","ε[stem]ομεθα","ε[stem]εσθε","ε[stem]οντο"]},
    {"id":"verb_16","title":"Imperfect εἰμί","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ἢμην","ἦς","ἦν","ἦμεν / ἢμεθα","ἦτε","ἦσαν"]},
    {"id":"verb_17","title":"First Aorist (active)","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]σα","ε[stem]σας","ε[stem]σε(ν)","ε[stem]σαμεν","ε[stem]σατε","ε[stem]σαν"]},
    {"id":"verb_18","title":"First Aorist (middle)","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]σαμην","ε[stem]σω","ε[stem]σατο","ε[stem]σαμεθα","ε[stem]σασθε","ε[stem]σαντο"]},
    {"id":"verb_19","title":"First Aorist Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]θην","ε[stem]θης","ε[stem]θη","ε[stem]θημεν","ε[stem]θητε","ε[stem]θησαν"]},
    {"id":"verb_20","title":"Second Aorist Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["ε[stem]ην","ε[stem]ης","ε[stem]η","ε[stem]ημεν","ε[stem]ητε","ε[stem]ησαν"]},
    {"id":"verb_21","title":"Perfect Active Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["[reduplication][stem]κα","[reduplication][stem]κας","[reduplication][stem]κε(ν)","[reduplication][stem]καμεν","[reduplication][stem]κατε","[reduplication][stem]κασι(ν)"]},
    {"id":"verb_22","title":"Perfect Middle/Passive Indicative","labels":["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"],"forms":["[reduplication][stem]μαι","[reduplication][stem]σαι","[reduplication][stem]ται","[reduplication][stem]μεθα","[reduplication][stem]σθε","[reduplication][stem]νται"]}
  ],

  PRONOUN_CHARTS: [
    {"id":"relative_pronoun","title":"Relative Pronoun","labels":["Sg Nominative (M)","Sg Nominative (F)","Sg Nominative (N)","Sg Genitive (M)","Sg Genitive (F)","Sg Genitive (N)","Sg Dative (M)","Sg Dative (F)","Sg Dative (N)","Sg Accusative (M)","Sg Accusative (F)","Sg Accusative (N)","Pl Nominative (M)","Pl Nominative (F)","Pl Nominative (N)","Pl Genitive (M)","Pl Genitive (F)","Pl Genitive (N)","Pl Dative (M)","Pl Dative (F)","Pl Dative (N)","Pl Accusative (M)","Pl Accusative (F)","Pl Accusative (N)"],"forms":["ὃς","ἣ","ὃ","οὗ","ἧς","οὗ","ᾧ","ᾗ","ᾧ","ὃν","ἣν","ὃ","οἳ","αἳ","ἃ","ὧν","ὧν","ὧν","οἷς","αἷς","οἷς","οὓς","ἃς","ἃ"]},
    {"id":"αὐτὸς","title":"αὐτὸς","labels":["Sg Nominative (M)","Sg Nominative (F)","Sg Nominative (N)","Sg Genitive (M)","Sg Genitive (F)","Sg Genitive (N)","Sg Dative (M)","Sg Dative (F)","Sg Dative (N)","Sg Accusative (M)","Sg Accusative (F)","Sg Accusative (N)","Pl Nominative (M)","Pl Nominative (F)","Pl Nominative (N)","Pl Genitive (M)","Pl Genitive (F)","Pl Genitive (N)","Pl Dative (M)","Pl Dative (F)","Pl Dative (N)","Pl Accusative (M)","Pl Accusative (F)","Pl Accusative (N)"],"forms":["αὐτός","αὐτή","αὐτό","αὐτοῦ","αὐτῆς","αὐτοῦ","αὐτῷ","αὐτῇ","αὐτῷ","αὐτόν","αὐτήν","αὐτό","αὐτοί","αὐταί","αὐτά","αὐτῶν","αὐτῶν","αὐτῶν","αὐτοῖς","αὐταῖς","αὐτοῖς","αὐτούς","αὐτάς","αὐτά"]},
    {"id":"οὑτος","title":"οὑτος","labels":["Sg Nominative (M)","Sg Nominative (F)","Sg Nominative (N)","Sg Genitive (M)","Sg Genitive (F)","Sg Genitive (N)","Sg Dative (M)","Sg Dative (F)","Sg Dative (N)","Sg Accusative (M)","Sg Accusative (F)","Sg Accusative (N)","Pl Nominative (M)","Pl Nominative (F)","Pl Nominative (N)","Pl Genitive (M)","Pl Genitive (F)","Pl Genitive (N)","Pl Dative (M)","Pl Dative (F)","Pl Dative (N)","Pl Accusative (M)","Pl Accusative (F)","Pl Accusative (N)"],"forms":["οὗτος","αὓτη","τοῦτο","τούτου","ταύτης","τούτου","τούτῳ","ταύτῃ","τούτῳ","τοῦτον","ταύτην","τοῦτο","οὗτοι","αὗται","ταῦτα","τούτων","τούτων","τούτων","τούτοις","ταύταις","τούτοις","τούτους","ταύτας","ταῦτα"]},
    {"id":"ἐκεῖνος","title":"ἐκεῖνος","labels":["Sg Nominative (M)","Sg Nominative (F)","Sg Nominative (N)","Sg Genitive (M)","Sg Genitive (F)","Sg Genitive (N)","Sg Dative (M)","Sg Dative (F)","Sg Dative (N)","Sg Accusative (M)","Sg Accusative (F)","Sg Accusative (N)","Pl Nominative (M)","Pl Nominative (F)","Pl Nominative (N)","Pl Genitive (M)","Pl Genitive (F)","Pl Genitive (N)","Pl Dative (M)","Pl Dative (F)","Pl Dative (N)","Pl Accusative (M)","Pl Accusative (F)","Pl Accusative (N)"],"forms":["ἐκεῖνος","ἐκείνη","ἐκεῖνο","ἐκείνου","ἐκείνης","ἐκείνου","ἐκείνῳ","ἐκείνῃ","ἐκείνῳ","ἐκεῖνον","ἐκείνην","ἐκεῖνο","ἐκεῖνοι","ἐκεῖναι","ἐκεῖνα","ἐκείνων","ἐκείνων","ἐκείνων","ἐκείνοις","ἐκείναις","ἐκείνοις","ἐκείνους","ἐκείνας","ἐκεῖνα"]}
  ],

  ENDING_CHARTS: [
    {"id":"article_endings","title":"Article Endings (ὁ / ἡ / τό)","labels":["Sg Nominative (M)","Sg Nominative (F)","Sg Nominative (N)","Sg Genitive (M)","Sg Genitive (F)","Sg Genitive (N)","Sg Dative (M)","Sg Dative (F)","Sg Dative (N)","Sg Accusative (M)","Sg Accusative (F)","Sg Accusative (N)","Pl Nominative (M)","Pl Nominative (F)","Pl Nominative (N)","Pl Genitive (M)","Pl Genitive (F)","Pl Genitive (N)","Pl Dative (M)","Pl Dative (F)","Pl Dative (N)","Pl Accusative (M)","Pl Accusative (F)","Pl Accusative (N)"],"forms":["ὁ","ἡ","τό","του","της","του","τῳ","τῃ","τῳ","τόν","τήν","τό","οἱ","αἱ","τά","των","των","των","τοις","ταις","τοις","τούς","τάς","τά"]},
    {"id":"case_endings","title":"Case Endings (Declensions)","labels":["Sg Nominative — 2nd Declension Masculine","Sg Nominative — 2nd declension Neuter","Sg Nominative — 3rd Declension Masculine/Feminine","Sg Genitive — 2nd Declension Masculine","Sg Genitive — 1st Declension Feminine","Sg Genitive — 2nd declension Neuter","Sg Genitive — 3rd Declension Masculine/Feminine","Sg Genitive — 3rd Declension Neuter","Sg Dative — 2nd Declension Masculine","Sg Dative — 1st Declension Feminine","Sg Dative — 2nd declension Neuter","Sg Dative — 3rd Declension Masculine/Feminine","Sg Dative — 3rd Declension Neuter","Sg Accusative — 2nd Declension Masculine","Sg Accusative — 1st Declension Feminine","Sg Accusative — 2nd declension Neuter","Sg Accusative — 3rd Declension Masculine/Feminine","Pl Nominative — 2nd Declension Masculine","Pl Nominative — 1st Declension Feminine","Pl Nominative — 2nd declension Neuter","Pl Nominative — 3rd Declension Masculine/Feminine","Pl Nominative — 3rd Declension Neuter","Pl Genitive — 2nd Declension Masculine","Pl Genitive — 1st Declension Feminine","Pl Genitive — 2nd declension Neuter","Pl Genitive — 3rd Declension Masculine/Feminine","Pl Genitive — 3rd Declension Neuter","Pl Dative — 2nd Declension Masculine","Pl Dative — 1st Declension Feminine","Pl Dative — 2nd declension Neuter","Pl Dative — 3rd Declension Masculine/Feminine","Pl Dative — 3rd Declension Neuter","Pl Accusative — 2nd Declension Masculine","Pl Accusative — 1st Declension Feminine","Pl Accusative — 2nd declension Neuter","Pl Accusative — 3rd Declension Masculine/Feminine","Pl Accusative — 3rd Declension Neuter"],"forms":["ος","ον","ς","ου","ς","ου","ος","ος","ῳ","ῃ","ῳ","ι","ι","ον","ην","ον","α","οι","αι","α","ες","α","ων","ων","ων","ων","ων","οις","αις","οις","σι(ν)","σι(ν)","ους","ας","α","ας","α"]},
    {"id":"present_imperfective_participle","title":"Present (Imperfective) Participle","labels":["Sg Nominative — 3rd M","Sg Nominative — 1st F","Sg Nominative — 3rd N","Sg Genitive — 3rd M","Sg Genitive — 1st F","Sg Genitive — 3rd N","Sg Dative — 3rd M","Sg Dative — 1st F","Sg Dative — 3rd N","Sg Accusative — 3rd M","Sg Accusative — 1st F","Sg Accusative — 3rd N","Pl Nominative — 3rd M","Pl Nominative — 1st F","Pl Nominative — 3rd N","Pl Genitive — 3rd M","Pl Genitive — 1st F","Pl Genitive — 3rd N","Pl Dative — 3rd M","Pl Dative — 1st F","Pl Dative — 3rd N","Pl Accusative — 3rd M","Pl Accusative — 1st F","Pl Accusative — 3rd N"],"forms":["ων","ουσα","ον","οντος","ης","οντος","οντι","ῃ","οντι","οντα","αν","ον","οντες","αι","οντα","οντων","ων","οντων","ουσι(ν)","αις","ουσι(ν)","οντας","ας","οντα"]},
    {"id":"εἰμί_present_imperfect_participle","title":"εἰμί (Present (Imperfect) Participle)","labels":["Sg Nominative — ὢν","Sg Nominative — οὖσα","Sg Nominative — ὂν","Sg Genitive — ὢν","Sg Genitive — οὖσα","Sg Genitive — ὂν","Sg Dative — ὢν","Sg Dative — οὖσα","Sg Dative — ὂν","Sg Accusative — ὢν","Sg Accusative — οὖσα","Sg Accusative — ὂν","Pl Nominative — ὢν","Pl Nominative — οὖσα","Pl Nominative — ὂν","Pl Genitive — ὢν","Pl Genitive — οὖσα","Pl Genitive — ὂν","Pl Dative — ὢν","Pl Dative — οὖσα","Pl Dative — ὂν"],"forms":["ὂντος","οὒσης","ὂντος","ὂντι","οὒσῃ","ὂντι","ὂντα","οὖσαν","ὂν","ὂντες","οὖσαι","ὂντα","ὂντων","οὐσῶν","ὂντων","οὖσι(ν)","οὒσαις","οὖσι(ν)","ὂντας","οὒσας","ὂντα"]},
    {"id":"present_imperfect_middle_passive_partici","title":"Present (Imperfect) Middle/Passive Participle","labels":["Sg Nominative — 3rd M","Sg Nominative — 1st F","Sg Nominative — 3rd N","Sg Genitive — 3rd M","Sg Genitive — 1st F","Sg Genitive — 3rd N","Sg Dative — 3rd M","Sg Dative — 1st F","Sg Dative — 3rd N","Sg Accusative — 3rd M","Sg Accusative — 1st F","Sg Accusative — 3rd N","Pl Nominative — 3rd M","Pl Nominative — 1st F","Pl Nominative — 3rd N","Pl Genitive — 3rd M","Pl Genitive — 1st F","Pl Genitive — 3rd N","Pl Dative — 3rd M","Pl Dative — 1st F","Pl Dative — 3rd N","Pl Accusative — 3rd M","Pl Accusative — 1st F","Pl Accusative — 3rd N"],"forms":["ομενος","ομενη","ομενον","ομενου","ομενης","ομενου","ομενῳ","ομενῃ","ομενῳ","ομενον","ομενην","ομενον","ομενοι","ομεναι","ομενα","ομενων","ομενων","ομενων","ομενοις","ομεναις","ομενοις","ομενους","ομενας","ομενα"]}
  ],

  ACTIVITIES: [
    {"id":"vocab_fill","title":"Vocab Quiz (Fill in the Blank)","type":"vocab_fill","group":"Vocab"},
    {"id":"flashcards","title":"Flashcards","type":"flash","group":"Vocab"},

    {"id":"verb_fill","title":"Verb Quiz (Fill in the Blank)","type":"verb_fill","group":"Verbs"},
    {"id":"verb_tf","title":"Verb Quiz (True/False)","type":"verb_tf","group":"Verbs"},
    {"id":"verb_mc","title":"Verb Quiz (Multiple Choice)","type":"verb_mc","group":"Verbs"},
    {"id":"verb_conj","title":"Verb Conjugation (Chart)","type":"verb_conj","group":"Verbs"},

    {"id":"act_verb_17","title":"First Aorist (active)","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_17"},
    {"id":"act_verb_18","title":"First Aorist (middle)","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_18"},
    {"id":"act_verb_19","title":"First Aorist Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_19"},
    {"id":"act_verb_10","title":"First Future Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_10"},
    {"id":"act_verb_05","title":"Future Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_05"},
    {"id":"act_verb_04","title":"Future Liquid Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_04"},
    {"id":"act_verb_09","title":"Future Liquid Middle for κρίνω","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_09"},
    {"id":"act_verb_07","title":"Future Liquid Middle Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_07"},
    {"id":"act_verb_06","title":"Future Middle Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_06"},
    {"id":"act_verb_08","title":"Future of εἰμί","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_08"},
    {"id":"act_verb_16","title":"Imperfect εἰμί","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_16"},
    {"id":"act_verb_21","title":"Perfect Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_21"},
    {"id":"act_verb_22","title":"Perfect Middle/Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_22"},
    {"id":"act_verb_01","title":"Present Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_01"},
    {"id":"act_verb_02","title":"Present Middle/Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_02"},
    {"id":"act_verb_03","title":"Present εἰμί","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_03"},
    {"id":"act_verb_12","title":"Primary Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_12"},
    {"id":"act_verb_14","title":"Primary Middle Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_14"},
    {"id":"act_verb_20","title":"Second Aorist Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_20"},
    {"id":"act_verb_11","title":"Second Future Passive Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_11"},
    {"id":"act_verb_13","title":"Secondary Active Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_13"},
    {"id":"act_verb_15","title":"Secondary Middle Indicative","type":"chart","group":"Verb Conjugations","chartGroup":"verbs","chartId":"verb_15"},

    {"id":"act_relative_pronoun","title":"Relative Pronoun","type":"chart","group":"Pronouns / Adjectives","chartGroup":"pronouns","chartId":"relative_pronoun"},
    {"id":"act_αὐτὸς","title":"αὐτὸς","type":"chart","group":"Pronouns / Adjectives","chartGroup":"pronouns","chartId":"αὐτὸς"},
    {"id":"act_οὑτος","title":"οὑτος","type":"chart","group":"Pronouns / Adjectives","chartGroup":"pronouns","chartId":"οὑτος"},
    {"id":"act_ἐκεῖνος","title":"ἐκεῖνος","type":"chart","group":"Pronouns / Adjectives","chartGroup":"pronouns","chartId":"ἐκεῖνος"},

    {"id":"act_article_endings","title":"Article Endings (ὁ / ἡ / τό)","type":"chart","group":"Nonverb Endings","chartGroup":"endings","chartId":"article_endings"},
    {"id":"act_case_endings","title":"Case Endings (Declensions)","type":"chart","group":"Nonverb Endings","chartGroup":"endings","chartId":"case_endings"},
    {"id":"act_present_imperfective_participle","title":"Present (Imperfective) Participle","type":"chart","group":"Nonverb Endings","chartGroup":"endings","chartId":"present_imperfective_participle"},
    {"id":"act_εἰμί_present_imperfect_participle","title":"εἰμί (Present (Imperfect) Participle)","type":"chart","group":"Nonverb Endings","chartGroup":"endings","chartId":"εἰμί_present_imperfect_participle"},
    {"id":"act_present_imperfect_middle_passive_partici","title":"Present (Imperfect) Middle/Passive Participle","type":"chart","group":"Nonverb Endings","chartGroup":"endings","chartId":"present_imperfect_middle_passive_partici"}
  ]
};

const { VOCAB, VERBS, VERB_CHARTS, PRONOUN_CHARTS, ENDING_CHARTS, ACTIVITIES } = DATA;

const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));

function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function toast(title, msg){
  $("#toastTitle").textContent = title;
  $("#toastMsg").textContent = msg;
  const el = $("#toast");
  el.classList.add("show");
  clearTimeout(window.__toastT);
  window.__toastT = setTimeout(()=>el.classList.remove("show"), 1400);
}

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function norm(s){
  return String(s)
    .toLowerCase()
    .replace(/\u00a0/g,' ')
    .replace(/[^a-z0-9\s]/g,' ')
    .replace(/\s+/g,' ')
    .trim();
}

function buildAcceptable(english){
  const raw = String(english);
  const parts = raw.split(/[,;\/]|\bor\b/gi).map(x=>x.trim()).filter(Boolean);
  const set = new Set();
  set.add(norm(raw));
  for(const p of parts) set.add(norm(p));
  raw.split(/—|–/).map(x=>x.trim()).filter(Boolean).forEach(x=>set.add(norm(x)));
  return set;
}

const CHART_MAP = {
  verbs: VERB_CHARTS,
  pronouns: PRONOUN_CHARTS,
  endings: ENDING_CHARTS
};

/* =========================
   Sidebar
   ========================= */
let activeActivityId = "vocab_fill";

function groupActivities(list){
  const map = new Map();
  for(const a of list){
    if(!map.has(a.group)) map.set(a.group, []);
    map.get(a.group).push(a);
  }
  return map;
}

function renderSidebar(){
  const q = $("#activitySearch").value.trim().toLowerCase();
  const filtered = !q ? ACTIVITIES : ACTIVITIES.filter(a => a.title.toLowerCase().includes(q) || a.group.toLowerCase().includes(q));
  const grouped = groupActivities(filtered);

  const side = $("#sideList");
  side.innerHTML = "";
  for(const [g, items] of grouped.entries()){
    const gt = document.createElement("div");
    gt.className = "groupTitle";
    gt.textContent = g;
    side.appendChild(gt);

    items.sort((a,b)=>a.title.localeCompare(b.title));
    for(const it of items){
      const btn = document.createElement("button");
      btn.className = "itemBtn" + (it.id===activeActivityId ? " active":"");
      btn.dataset.id = it.id;

      const left = document.createElement("div");
      left.style.minWidth = "0";
      left.style.flex = "1 1 auto";
      left.textContent = it.title;

      const tag = document.createElement("span");
      tag.className = "tag";
      tag.textContent =
        it.type === "chart" ? "Chart" :
        it.type === "flash" ? "Cards" :
        it.type === "verb_conj" ? "Chart" :
        "Type";

      btn.appendChild(left);
      btn.appendChild(tag);

      btn.addEventListener("click", ()=> {
        activeActivityId = it.id;
        resetSessionForActivity();
        renderSidebar();
        renderMain();
      });
      side.appendChild(btn);
    }
  }

  const chartCount = VERB_CHARTS.length + PRONOUN_CHARTS.length + ENDING_CHARTS.length;
  $("#sideMeta").textContent = `${VOCAB.length} vocab • ${chartCount} charts • ${VERBS.length} verbs`;
}

$("#activitySearch").addEventListener("input", renderSidebar);

/* =========================
   Session State
   ========================= */
let session = {
  items: [],
  index: 0,
  score: 0,
  streak: 0,
  locked: false,

  // chart state
  chart: null,
  filled: [],
  used: new Set(),
  focus: 0,
  graded: false,
  bank: [],

  // verb chart state
  verbLex: null,
  verbChartMode: "present_act"
};

function getActiveActivity(){
  return ACTIVITIES.find(a=>a.id===activeActivityId) || ACTIVITIES[0];
}

function setHeader(title, sub){
  $("#mainTitle").textContent = title;
  $("#mainSub").textContent = sub;
}

function updateStats(){
  const total = session.items.length || 0;
  const at = total ? Math.min(session.index+1, total) : 0;
  $("#statProgress").textContent = `${at}/${total}`;
  $("#statScore").textContent = String(session.score);
  $("#statStreak").textContent = String(session.streak);
  const pct = total ? (session.index/total)*100 : 0;
  $("#progressFill").style.width = `${Math.max(0, Math.min(100,pct))}%`;
}

function resetSessionForActivity(){
  const a = getActiveActivity();
  session.index = 0;
  session.score = 0;
  session.streak = 0;
  session.locked = false;

  session.chart = null;
  session.filled = [];
  session.used = new Set();
  session.focus = 0;
  session.graded = false;
  session.bank = [];

  if(a.type === "vocab_fill" || a.type === "flash"){
    session.items = shuffle(VOCAB);
  } else if(a.type === "verb_fill" || a.type === "verb_tf" || a.type === "verb_mc"){
    session.items = shuffle(VERBS);
  } else if(a.type === "verb_conj"){
    session.items = [a];
    session.verbLex = VERBS[0]?.g || null;
    session.verbChartMode = "present_act";
    primeVerbConjChart();
  } else if(a.type === "chart"){
    session.items = [a];
    session.chart = (CHART_MAP[a.chartGroup] || []).find(c=>c.id===a.chartId) || null;
    session.bank = session.chart ? shuffle(session.chart.forms) : [];
  }
  updateStats();
}

function nextItem(){
  session.index++;
  session.locked = false;
  updateStats();
  renderMain();
}

function prevItem(){
  if(session.index===0) return;
  session.index--;
  session.locked = false;
  updateStats();
  renderMain();
}

/* =========================
   Verb conjugation generator (best-effort)
   ========================= */
const PERSON_LABELS = ["1st sg","2nd sg","3rd sg","1st pl","2nd pl","3rd pl"];

function stripDiacritics(s){
  // only for rough stem work; we keep original output characters
  return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC");
}

function guessVerbClass(lex){
  const t = lex.trim();
  if(t === "εἰμί") return { kind:"irreg", id:"eimi" };
  if(stripDiacritics(t) === "οιδα" || t === "οἶδα") return { kind:"irreg", id:"oida" };

  if(t.endsWith("ομαι")) return { kind:"deponent", stem: t.slice(0,-4), contract:null };
  if(t.endsWith("άω") || t.endsWith("άω")) return { kind:"omega", stem: t.slice(0,-2), contract:"a" };
  if(t.endsWith("έω")) return { kind:"omega", stem: t.slice(0,-2), contract:"e" };
  if(t.endsWith("όω")) return { kind:"omega", stem: t.slice(0,-2), contract:"o" };
  if(t.endsWith("ω")) return { kind:"omega", stem: t.slice(0,-1), contract:null };

  return { kind:"unknown", stem: t };
}

function conjPresentAct(info){
  if(info.kind==="irreg" && info.id==="eimi"){
    return ["εἰμι","εἶ","ἐστιν","ἐσμεν","ἐστε","εἰσιν"];
  }
  if(info.kind!=="omega") return PERSON_LABELS.map(()=>"[—]");
  if(info.contract==="a"){
    // very common alpha-contract pattern (basic)
    return [info.stem+"ῶ", info.stem+"ᾷς", info.stem+"ᾷ", info.stem+"ῶμεν", info.stem+"ᾶτε", info.stem+"ῶσι(ν)"];
  }
  if(info.contract==="e"){
    return [info.stem+"ῶ", info.stem+"εῖς", info.stem+"εῖ", info.stem+"οῦμεν", info.stem+"εῖτε", info.stem+"οῦσι(ν)"];
  }
  if(info.contract==="o"){
    return [info.stem+"ῶ", info.stem+"οῖς", info.stem+"οῖ", info.stem+"οῦμεν", info.stem+"οῦτε", info.stem+"οῦσι(ν)"];
  }
  return [info.stem+"ω", info.stem+"εις", info.stem+"ει", info.stem+"ομεν", info.stem+"ετε", info.stem+"ουσι(ν)"];
}

function conjPresentMP(info){
  if(info.kind==="irreg" && info.id==="eimi"){
    return ["—","—","—","—","—","—"];
  }
  if(info.kind==="deponent"){
    // already ends in -ομαι, treat stem for endings
    return [info.stem+"ομαι", info.stem+"ῃ", info.stem+"εται", info.stem+"ομεθα", info.stem+"εσθε", info.stem+"ονται"];
  }
  if(info.kind!=="omega") return PERSON_LABELS.map(()=>"[—]");
  return [info.stem+"ομαι", info.stem+"ῃ", info.stem+"εται", info.stem+"ομεθα", info.stem+"εσθε", info.stem+"ονται"];
}

function conjFutureAct(info){
  if(info.kind!=="omega") return PERSON_LABELS.map(()=>"[—]");
  // basic: stem + σ + endings (best-effort)
  return [info.stem+"σω", info.stem+"σεις", info.stem+"σει", info.stem+"σομεν", info.stem+"σετε", info.stem+"σουσι(ν)"];
}

function conjAoristAct(info){
  if(info.kind!=="omega") return PERSON_LABELS.map(()=>"[—]");
  // best-effort augment: "ἐ" + stem + σα ...
  const aug = "ἐ";
  return [aug+info.stem+"σα", aug+info.stem+"σας", aug+info.stem+"σε(ν)", aug+info.stem+"σαμεν", aug+info.stem+"σατε", aug+info.stem+"σαν"];
}

function conjPerfectAct(info){
  if(info.kind!=="omega") return PERSON_LABELS.map(()=>"[—]");
  // best-effort reduplication: first letter + ε + stem
  const s = stripDiacritics(info.stem);
  const first = info.stem[0] || "";
  const red = first ? (first + "ε") : "";
  const base = red + info.stem;
  return [base+"κα", base+"κας", base+"κε(ν)", base+"καμεν", base+"κατε", base+"κασι(ν)"];
}

const VERB_CHART_MODES = [
  { id:"present_act", label:"Present Active Indicative", build: (info)=>conjPresentAct(info) },
  { id:"present_mp",  label:"Present Middle/Passive Indicative", build: (info)=>conjPresentMP(info) },
  { id:"future_act",  label:"Future Active Indicative", build: (info)=>conjFutureAct(info) },
  { id:"aorist_act",  label:"First Aorist (active) (best-effort)", build: (info)=>conjAoristAct(info) },
  { id:"perfect_act", label:"Perfect Active Indicative (best-effort)", build: (info)=>conjPerfectAct(info) }
];

function primeVerbConjChart(){
  const info = guessVerbClass(session.verbLex || "");
  const mode = VERB_CHART_MODES.find(m=>m.id===session.verbChartMode) || VERB_CHART_MODES[0];
  const forms = mode.build(info);

  session.chart = {
    id: "verb_dynamic",
    title: mode.label,
    labels: PERSON_LABELS,
    forms
  };
  session.filled = [];
  session.used = new Set();
  session.focus = 0;
  session.graded = false;
  session.bank = shuffle(forms);
}

/* =========================
   Render dispatch
   ========================= */
function renderMain(){
  const a = getActiveActivity();
  if(a.type === "vocab_fill") return renderVocabFill();
  if(a.type === "flash") return renderFlashcards();
  if(a.type === "verb_fill") return renderVerbFill();
  if(a.type === "verb_tf") return renderVerbTF();
  if(a.type === "verb_mc") return renderVerbMC();
  if(a.type === "verb_conj") return renderVerbConj();
  if(a.type === "chart") return renderChart(); // existing charts
}

/* =========================
   Vocab Fill
   ========================= */
function renderVocabFill(){
  setHeader("Vocab Quiz (Fill in the Blank)", "All vocab, one at a time. Type the English gloss and press Enter.");
  const cur = session.items[session.index];
  const root = $("#content");

  if(!cur){
    root.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-size:18px; font-weight:800;">Done</div>
            <div class="muted">Final score: <b>${session.score}</b> / ${VOCAB.length}</div>
          </div>
          <button class="btn primary" id="restartBtn">Restart</button>
        </div>
      </div>
    `;
    $("#restartBtn").addEventListener("click", ()=>{ resetSessionForActivity(); renderMain(); });
    return;
  }

  root.innerHTML = `
    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Greek</div>
          <div class="bigGreek">${escapeHtml(cur.g)}</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="peekBtn">Peek</button>
          <button class="btn" id="skipBtn">Skip</button>
        </div>
      </div>

      <div style="margin-top:14px;">
        <div class="muted">English (type and press Enter)</div>
        <form id="answerForm" autocomplete="off">
          <input id="answerInput" class="input" type="text" placeholder="Type the meaning…" />
        </form>
        <div id="fb" style="display:none;" class="feedback"></div>
      </div>

      <div class="row" style="margin-top:14px;">
        <div class="muted">Shortcuts: <span class="kbd">Enter</span> submit • <span class="kbd">N</span> next • <span class="kbd">P</span> previous</div>
        <button class="btn primary" id="nextBtn" disabled>Next</button>
      </div>
    </div>
  `;

  const input = $("#answerInput");
  const fb = $("#fb");
  const nextBtn = $("#nextBtn");
  const form = $("#answerForm");

  input.focus();

  function grade(){
    if(session.locked) return;
    const guess = norm(input.value);
    const ok = buildAcceptable(cur.e).has(guess);
    session.locked = true;

    if(ok){
      input.classList.add("ok");
      fb.className = "feedback ok";
      fb.innerHTML = `<b>Correct.</b> ${escapeHtml(cur.e)}`;
      session.score++;
      session.streak++;
      toast("Correct", `Streak: ${session.streak}`);
    } else {
      input.classList.add("bad");
      fb.className = "feedback bad";
      fb.innerHTML = `<b>Wrong.</b> Correct answer: ${escapeHtml(cur.e)}`;
      session.streak = 0;
      toast("Not quite", "Streak reset.");
    }
    fb.style.display = "block";
    nextBtn.disabled = false;
    nextBtn.focus();
    updateStats();
  }

  form.addEventListener("submit", (e)=>{ e.preventDefault(); grade(); });
  nextBtn.addEventListener("click", ()=> nextItem());

  $("#peekBtn").addEventListener("click", ()=> toast("Answer", cur.e));
  $("#skipBtn").addEventListener("click", ()=>{
    session.locked = false;
    session.streak = 0;
    toast("Skipped", "Moving on.");
    nextItem();
  });
}

/* =========================
   Flashcards
   ========================= */
function renderFlashcards(){
  setHeader("Flashcards", "All vocab, flip to reveal. Mark ✓ or ✕.");
  const cur = session.items[session.index];
  const root = $("#content");

  if(!cur){
    root.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-size:18px; font-weight:800;">Done</div>
            <div class="muted">Score: <b>${session.score}</b> / ${VOCAB.length} (based on ✓ clicks)</div>
          </div>
          <button class="btn primary" id="restartBtn">Restart</button>
        </div>
      </div>
    `;
    $("#restartBtn").addEventListener("click", ()=>{ resetSessionForActivity(); renderMain(); });
    return;
  }

  root.innerHTML = `
    <div class="card" id="flashCard" style="cursor:pointer;">
      <div class="muted">Click to flip</div>
      <div class="bigGreek" id="flashFace">${escapeHtml(cur.g)}</div>
      <div class="muted" id="flashHint">Greek → English</div>

      <div class="row" style="margin-top:14px;">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="missBtn">✕ Missed</button>
          <button class="btn primary" id="gotBtn">✓ Got it</button>
        </div>
        <div class="muted">Shortcuts: <span class="kbd">Space</span> flip • <span class="kbd">N</span> next</div>
      </div>
    </div>
  `;

  let flipped = false;
  const face = $("#flashFace");
  const hint = $("#flashHint");

  function flip(){
    flipped = !flipped;
    face.textContent = flipped ? cur.e : cur.g;
    hint.textContent = flipped ? "English revealed" : "Greek → English";
  }

  $("#flashCard").addEventListener("click", (e)=>{
    if(e.target.closest("button")) return;
    flip();
  });

  $("#gotBtn").addEventListener("click", ()=>{
    session.score++;
    session.streak++;
    toast("Nice", `Streak: ${session.streak}`);
    nextItem();
  });
  $("#missBtn").addEventListener("click", ()=>{
    session.streak = 0;
    toast("Logged", "Keep going.");
    nextItem();
  });
}

/* =========================
   VERB QUIZZES
   ========================= */
function renderVerbFill(){
  setHeader("Verb Quiz (Fill in the Blank)", "All verbs. Type the English gloss and press Enter.");
  const cur = session.items[session.index];
  const root = $("#content");

  if(!cur){
    root.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-size:18px; font-weight:800;">Done</div>
            <div class="muted">Final score: <b>${session.score}</b> / ${VERBS.length}</div>
          </div>
          <button class="btn primary" id="restartBtn">Restart</button>
        </div>
      </div>
    `;
    $("#restartBtn").addEventListener("click", ()=>{ resetSessionForActivity(); renderMain(); });
    return;
  }

  root.innerHTML = `
    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Verb</div>
          <div class="bigGreek">${escapeHtml(cur.g)}</div>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="peekBtn">Peek</button>
          <button class="btn" id="skipBtn">Skip</button>
        </div>
      </div>

      <div style="margin-top:14px;">
        <div class="muted">English (type and press Enter)</div>
        <form id="answerForm" autocomplete="off">
          <input id="answerInput" class="input" type="text" placeholder="Type the meaning…" />
        </form>
        <div id="fb" style="display:none;" class="feedback"></div>
      </div>

      <div class="row" style="margin-top:14px;">
        <div class="muted">Shortcuts: <span class="kbd">Enter</span> submit • <span class="kbd">N</span> next</div>
        <button class="btn primary" id="nextBtn" disabled>Next</button>
      </div>
    </div>
  `;

  const input = $("#answerInput");
  const fb = $("#fb");
  const nextBtn = $("#nextBtn");
  const form = $("#answerForm");

  input.focus();

  function grade(){
    if(session.locked) return;
    const guess = norm(input.value);
    const ok = buildAcceptable(cur.e).has(guess);

    session.locked = true;
    if(ok){
      input.classList.add("ok");
      fb.className = "feedback ok";
      fb.innerHTML = `<b>Correct.</b> ${escapeHtml(cur.e)}`;
      session.score++;
      session.streak++;
      toast("Correct", `Streak: ${session.streak}`);
    } else {
      input.classList.add("bad");
      fb.className = "feedback bad";
      fb.innerHTML = `<b>Wrong.</b> Correct answer: ${escapeHtml(cur.e)}`;
      session.streak = 0;
      toast("Not quite", "Streak reset.");
    }
    fb.style.display = "block";
    nextBtn.disabled = false;
    nextBtn.focus();
    updateStats();
  }

  form.addEventListener("submit", (e)=>{ e.preventDefault(); grade(); });
  nextBtn.addEventListener("click", ()=> nextItem());

  $("#peekBtn").addEventListener("click", ()=> toast("Answer", cur.e));
  $("#skipBtn").addEventListener("click", ()=>{
    session.locked = false;
    session.streak = 0;
    toast("Skipped", "Moving on.");
    nextItem();
  });
}

function renderVerbTF(){
  setHeader("Verb Quiz (True/False)", "Decide if the gloss matches the verb.");
  const cur = session.items[session.index];
  const root = $("#content");

  if(!cur){
    root.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-size:18px; font-weight:800;">Done</div>
            <div class="muted">Score: <b>${session.score}</b> / ${VERBS.length}</div>
          </div>
          <button class="btn primary" id="restartBtn">Restart</button>
        </div>
      </div>
    `;
    $("#restartBtn").addEventListener("click", ()=>{ resetSessionForActivity(); renderMain(); });
    return;
  }

  const truth = Math.random() < 0.5;
  const wrong = shuffle(VERBS.filter(v=>v.g!==cur.g)).slice(0,1)[0];
  const shown = truth ? cur.e : (wrong?.e || cur.e);
  const correctAnswer = truth ? "true" : "false";

  root.innerHTML = `
    <div class="card">
      <div class="muted">Verb</div>
      <div class="bigGreek">${escapeHtml(cur.g)}</div>
      <div class="muted" style="margin-top:10px;">Statement</div>
      <div style="font-size:14px; margin-top:6px;"><b>${escapeHtml(shown)}</b></div>

      <div class="row" style="margin-top:14px;">
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="falseBtn">False</button>
          <button class="btn primary" id="trueBtn">True</button>
        </div>
        <button class="btn primary" id="nextBtn" disabled>Next</button>
      </div>

      <div id="fb" style="display:none;" class="feedback"></div>
    </div>
  `;

  const fb = $("#fb");
  const nextBtn = $("#nextBtn");

  function grade(ans){
    if(session.locked) return;
    session.locked = true;
    const ok = ans === correctAnswer;

    if(ok){
      fb.className = "feedback ok";
      fb.innerHTML = `<b>Correct.</b> ${escapeHtml(cur.e)}`;
      session.score++;
      session.streak++;
      toast("Correct", `Streak: ${session.streak}`);
    } else {
      fb.className = "feedback bad";
      fb.innerHTML = `<b>Wrong.</b> Correct: <b>${correctAnswer.toUpperCase()}</b> — ${escapeHtml(cur.e)}`;
      session.streak = 0;
      toast("Not quite", "Streak reset.");
    }
    fb.style.display = "block";
    nextBtn.disabled = false;
    nextBtn.focus();
    updateStats();
  }

  $("#trueBtn").addEventListener("click", ()=>grade("true"));
  $("#falseBtn").addEventListener("click", ()=>grade("false"));
  nextBtn.addEventListener("click", ()=> nextItem());
}

function renderVerbMC(){
  setHeader("Verb Quiz (Multiple Choice)", "Choose the correct gloss.");
  const cur = session.items[session.index];
  const root = $("#content");

  if(!cur){
    root.innerHTML = `
      <div class="card">
        <div class="row">
          <div>
            <div style="font-size:18px; font-weight:800;">Done</div>
            <div class="muted">Score: <b>${session.score}</b> / ${VERBS.length}</div>
          </div>
          <button class="btn primary" id="restartBtn">Restart</button>
        </div>
      </div>
    `;
    $("#restartBtn").addEventListener("click", ()=>{ resetSessionForActivity(); renderMain(); });
    return;
  }

  const distractors = shuffle(VERBS.filter(v=>v.g!==cur.g)).slice(0,3);
  const opts = shuffle([cur, ...distractors]);

  root.innerHTML = `
    <div class="card">
      <div class="muted">Verb</div>
      <div class="bigGreek">${escapeHtml(cur.g)}</div>

      <div class="muted" style="margin-top:12px;">Options</div>
      <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px;">
        ${opts.map((o,i)=>`<button class="btn" data-opt="${i}" type="button">${escapeHtml(o.e)}</button>`).join("")}
      </div>

      <div class="row" style="margin-top:14px;">
        <div class="muted">Pick one.</div>
        <button class="btn primary" id="nextBtn" disabled>Next</button>
      </div>

      <div id="fb" style="display:none;" class="feedback"></div>
    </div>
  `;

  const fb = $("#fb");
  const nextBtn = $("#nextBtn");

  $$("#content button[data-opt]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      if(session.locked) return;
      session.locked = true;

      const idx = Number(btn.dataset.opt);
      const chosen = opts[idx];
      const ok = chosen.g === cur.g;

      if(ok){
        fb.className = "feedback ok";
        fb.innerHTML = `<b>Correct.</b>`;
        session.score++;
        session.streak++;
        toast("Correct", `Streak: ${session.streak}`);
      } else {
        fb.className = "feedback bad";
        fb.innerHTML = `<b>Wrong.</b> Correct answer: ${escapeHtml(cur.e)}`;
        session.streak = 0;
        toast("Not quite", "Streak reset.");
      }
      fb.style.display = "block";
      nextBtn.disabled = false;
      nextBtn.focus();
      updateStats();
    });
  });

  nextBtn.addEventListener("click", ()=> nextItem());
}

function renderVerbConj(){
  setHeader("Verb Conjugation (Chart)", "Pick a verb + tense, then fill blanks like the other chart activities.");
  const root = $("#content");

  if(!session.verbLex) session.verbLex = VERBS[0]?.g || null;
  if(!session.chart) primeVerbConjChart();

  root.innerHTML = `
    <div class="card">
      <div class="row">
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <select id="verbSelect" class="miniSelect" title="Verb">
            ${VERBS.map(v=>`<option value="${escapeHtml(v.g)}"${v.g===session.verbLex?' selected':''}>${escapeHtml(v.g)}</option>`).join("")}
          </select>
          <select id="verbModeSelect" class="miniSelect" title="Tense/Voice">
            ${VERB_CHART_MODES.map(m=>`<option value="${m.id}"${m.id===session.verbChartMode?' selected':''}>${escapeHtml(m.label)}</option>`).join("")}
          </select>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn" id="reshuffleBtn">Reshuffle</button>
          <button class="btn" id="clearBtn">Clear</button>
        </div>
      </div>

      <div class="muted" style="margin-top:8px;">
        Verb gloss: <b>${escapeHtml((VERBS.find(v=>v.g===session.verbLex)||{}).e || "")}</b>
      </div>

      <div style="margin-top:14px;" id="verbChartHost"></div>
    </div>
  `;

  $("#verbSelect").addEventListener("change", (e)=>{
    session.verbLex = e.target.value;
    primeVerbConjChart();
    renderVerbConj();
  });
  $("#verbModeSelect").addEventListener("change", (e)=>{
    session.verbChartMode = e.target.value;
    primeVerbConjChart();
    renderVerbConj();
  });

  $("#clearBtn").addEventListener("click", ()=>{
    session.filled = [];
    session.used = new Set();
    session.focus = 0;
    session.graded = false;
    session.bank = shuffle(session.chart.forms);
    toast("Cleared", "Chart cleared.");
    renderVerbConj();
  });

  $("#reshuffleBtn").addEventListener("click", ()=>{
    session.bank = shuffle(session.chart.forms);
    toast("Reshuffled", "Option bank reshuffled.");
    renderVerbConj();
  });

  // reuse chart renderer inside host
  const host = $("#verbChartHost");
  host.innerHTML = renderChartInner(session.chart, { titleOverride: null });
}

/* =========================
   Chart Renderer (generic)
   ========================= */

function isPronounLike(chart){
  // 24 slots with (M)(F)(N) pattern -> render 3-column grid w/ centered headers
  return chart && Array.isArray(chart.labels) && chart.labels.length === 24 &&
    chart.labels.slice(0,3).some(x=>/\(M\)|\(F\)|\(N\)/.test(x));
}

function renderPronounGrid(chart){
  // expected order: Sg Nom M/F/N, Sg Gen M/F/N, Sg Dat M/F/N, Sg Acc M/F/N, Pl Nom..., Pl Gen..., Pl Dat..., Pl Acc...
  const rows = [
    {lab:"Sg Nominative", idx: 0},
    {lab:"Sg Genitive",   idx: 3},
    {lab:"Sg Dative",     idx: 6},
    {lab:"Sg Accusative", idx: 9},
    {lab:"Pl Nominative", idx: 12},
    {lab:"Pl Genitive",   idx: 15},
    {lab:"Pl Dative",     idx: 18},
    {lab:"Pl Accusative", idx: 21},
  ];

  function slotHtml(i){
    const val = session.filled[i] || "";
    const cls = ["slot", val ? "filled":"", i===session.focus ? "active":""].join(" ");
    const display = val ? escapeHtml(val) : "_____";
    return `<span class="${cls}" data-slot="${i}">${display}</span>`;
  }

  return `
    <table class="chartTable">
      <thead>
        <tr>
          <th>Case/Number</th>
          <th class="centerTh">Masculine</th>
          <th class="centerTh">Feminine</th>
          <th class="centerTh">Neuter</th>
        </tr>
      </thead>
      <tbody>
        ${rows.map(r=>{
          const m = r.idx, f = r.idx+1, n = r.idx+2;
          return `
            <tr>
              <td>${escapeHtml(r.lab)}</td>
              <td class="centerTd">${slotHtml(m)}</td>
              <td class="centerTd">${slotHtml(f)}</td>
              <td class="centerTd">${slotHtml(n)}</td>
            </tr>
          `;
        }).join("")}
      </tbody>
    </table>
  `;
}

function renderChartInner(chart, { titleOverride } = {}){
  if(!chart) return `<div class="card"><b>Chart not found.</b></div>`;

  // Ensure bank exists and matches chart length
  if(!session.bank || session.bank.length !== chart.forms.length){
    session.bank = shuffle(chart.forms);
  }

  const total = chart.forms.length;
  const filledCount = session.filled.filter(Boolean).length;

  function slotHtml(idx){
    const val = session.filled[idx] || "";
    const cls = ["slot", val ? "filled":"", idx===session.focus ? "active":""].join(" ");
    const display = val ? escapeHtml(val) : "_____";
    return `<span class="${cls}" data-slot="${idx}">${display}</span>`;
  }

  let table = "";
  if(isPronounLike(chart)){
    table = renderPronounGrid(chart);
  } else if(total===6 && chart.labels && chart.labels.length===6){
    table = `
      <table class="chartTable">
        <thead><tr><th>Person</th><th>Blank</th></tr></thead>
        <tbody>
          ${chart.labels.map((lab, idx)=>`<tr><td>${escapeHtml(lab)}</td><td>${slotHtml(idx)}</td></tr>`).join("")}
        </tbody>
      </table>
    `;
  } else {
    table = `
      <table class="chartTable">
        <thead><tr><th>Slot</th><th>Blank</th></tr></thead>
        <tbody>
          ${chart.labels.map((lab, idx)=>`<tr><td>${escapeHtml(lab)}</td><td>${slotHtml(idx)}</td></tr>`).join("")}
        </tbody>
      </table>
    `;
  }

  const html = `
    <div class="chartWrap">
      <div class="card">
        <div class="row">
          <div class="muted">Filled: <b>${filledCount}</b> / ${total}</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" id="undoBtn">Undo</button>
            <button class="btn" id="revealBtn">Reveal next</button>
            <button class="btn primary" id="gradeBtn">Grade</button>
          </div>
        </div>

        <div style="margin-top:12px;">
          ${table}
        </div>

        <div class="row" style="margin-top:14px;">
          <div class="muted">Shortcuts: <span class="kbd">U</span> undo • <span class="kbd">R</span> reshuffle</div>
          <button class="btn primary" id="doneNextBtn" ${session.graded ? "" : "disabled"}>Keep practicing</button>
        </div>

        <div id="chartStatus" class="muted" style="margin-top:10px;"></div>
      </div>

      <div class="card">
        <div class="row">
          <div>
            <div style="font-weight:800;">Option bank</div>
            <div class="muted">Click the correct option for the focused blank.</div>
          </div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" id="reshuffleBtn2">Reshuffle</button>
            <button class="btn" id="clearBtn2">Clear</button>
          </div>
        </div>

        <div id="bank" class="bank"></div>
      </div>
    </div>
  `;

  // after insert, we wire events in renderChart()
  return html;
}

function renderChart(){
  const a = getActiveActivity();
  const chart = session.chart;
  const root = $("#content");
  if(!chart){
    root.innerHTML = `<div class="card"><b>Chart not found.</b></div>`;
    return;
  }

  setHeader(chart.title, `${a.group} • Click options to fill blanks in order. Click a blank to change focus.`);

  root.innerHTML = renderChartInner(chart);

  const total = chart.forms.length;

  function pickTargetSlot(){
    if(!session.filled[session.focus]) return session.focus;
    for(let j=session.focus+1; j<total; j++) if(!session.filled[j]) return j;
    for(let j=0; j<total; j++) if(!session.filled[j]) return j;
    return -1;
  }

  function repaintSlots(){
    const slotEls = $$("#content .slot");
    slotEls.forEach((el)=>{
      const idx = Number(el.dataset.slot);
      el.classList.remove("correct","wrong");
      const val = session.filled[idx];
      if(!val || !session.graded) return;
      el.classList.add(val===chart.forms[idx] ? "correct":"wrong");
    });
  }

  function renderBank(){
    const bank = $("#bank");
    bank.innerHTML = "";
    for(const form of session.bank){
      const used = session.used.has(form);
      const pill = document.createElement("button");
      pill.className = "pillOpt" + (used ? " used":"");
      pill.type = "button";
      pill.textContent = form;
      if(used) pill.disabled = true;

      pill.addEventListener("click", ()=>{
        if(session.graded) return;
        const target = pickTargetSlot();
        if(target===-1) return;
        session.filled[target] = form;
        session.used.add(form);
        session.focus = Math.min(target+1, total-1);
        renderMain();
      });
      bank.appendChild(pill);
    }
  }

  $$("#content .slot").forEach(s => {
    s.addEventListener("click", ()=>{
      session.focus = Number(s.dataset.slot);
      renderMain();
    });
  });

  $("#undoBtn").addEventListener("click", ()=>{
    let last=-1;
    for(let k=total-1;k>=0;k--) if(session.filled[k]) { last=k; break; }
    if(last===-1) return;
    const removed=session.filled[last];
    session.filled[last]=null;
    session.used = new Set(session.filled.filter(Boolean));
    session.focus = last;
    session.graded = false;
    toast("Undo", `Removed: ${removed}`);
    renderMain();
  });

  $("#revealBtn").addEventListener("click", ()=>{
    const target = pickTargetSlot();
    if(target===-1) return;
    toast("Next answer", chart.forms[target]);
  });

  $("#gradeBtn").addEventListener("click", ()=>{
    session.graded = true;
    const correct = chart.forms.reduce((acc, f, idx)=>acc + ((session.filled[idx]||"")===f ? 1:0), 0);
    $("#chartStatus").innerHTML = `Score: <b>${correct}</b> / ${total}`;
    toast("Graded", `${correct}/${total}`);
    $("#doneNextBtn").disabled = false;
    repaintSlots();
  });

  $("#doneNextBtn").addEventListener("click", ()=>{
    session.filled = [];
    session.used = new Set();
    session.focus = 0;
    session.graded = false;
    session.bank = shuffle(chart.forms);
    toast("Again", "Fresh run.");
    renderMain();
  });

  $("#reshuffleBtn2").addEventListener("click", ()=>{
    session.bank = shuffle(chart.forms);
    toast("Reshuffled", "Option bank reshuffled.");
    renderMain();
  });

  $("#clearBtn2").addEventListener("click", ()=>{
    session.filled = [];
    session.used = new Set();
    session.focus = 0;
    session.graded = false;
    session.bank = shuffle(chart.forms);
    toast("Cleared", "Chart cleared.");
    renderMain();
  });

  renderBank();
  repaintSlots();
  $("#chartStatus").textContent = session.graded ? "Graded. Fix mistakes or click “Keep practicing”." : "Fill the blanks, then click Grade.";
}

/* =========================
   Keyboard shortcuts
   ========================= */
document.addEventListener("keydown", (e)=>{
  const a = getActiveActivity();

  if(e.key.toLowerCase()==="n") {
    if(a.type==="vocab_fill" || a.type==="verb_fill") {
      const nextBtn = $("#nextBtn");
      if(nextBtn && !nextBtn.disabled) nextBtn.click();
      else if(session.locked) nextItem();
    } else if(a.type==="flash" || a.type==="verb_tf" || a.type==="verb_mc") {
      const nextBtn = $("#nextBtn");
      if(nextBtn && !nextBtn.disabled) nextBtn.click();
      else nextItem();
    }
  }

  if(e.key.toLowerCase()==="p") {
    if(a.type==="vocab_fill") prevItem();
  }

  if(a.type==="flash" && e.code==="Space") {
    e.preventDefault();
    const card = $("#flashCard");
    if(card) card.click();
  }

  if((a.type==="chart" || a.type==="verb_conj") && e.key.toLowerCase()==="r") {
    const btn = $("#reshuffleBtn2"); if(btn) btn.click();
  }
  if((a.type==="chart" || a.type==="verb_conj") && e.key.toLowerCase()==="u") {
    const btn = $("#undoBtn"); if(btn) btn.click();
  }
});

/* =========================
   Init
   ========================= */
renderSidebar();
resetSessionForActivity();
renderMain();
</script>
</body>
</html>
